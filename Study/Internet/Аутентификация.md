## Общий механизм HTTP аутентификации

Сценарий запрос-ответ подразумевает, что вначале сервер отвечает клиенту со статусом **401** и предоставляет информацию о порядке авторизации через заголовок *WWW-Authenticate*, содержащий хотя бы один метод авторизации. Клиент, который хочет аутентифицироваться, может сделать это, включив в следующий запрос заголовок *Authorization* с требуемыми данными.

### Прокси-аутентификация

В таком случае ответ посылает промежуточный прокси-сервер, который требует авторизации. Так как обе формы аутентификации могут сосуществовать, для них используются разные заголовки и коды статуса ответа.

### Доступ запрещен

Если сервер получает корректные учетные данные, но они не подходят для доступа к данному ресурсу, сервер должен отправить ответ со статус кодом *403 Forbidden*. В отличии от статус кода *401 Unauthorized* или *407 Proxy Authentication Required*, аутентификация для этого пользователя не возможна.

Во всех этих случаях сервер может предпочесть возвращать код состояния *404 Not Found*.

### Заголовки WWW=Аутентификации и Прокси-Аутентификации

[WWW-Authenticate](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate) и [Proxy-Authenticate](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Proxy-Authenticate) заголовки ответа которые определяют методы, что следует использовать для получения доступа к ресурсе. Они должны указывать, какую схему аутентификации использовать, чтобы клиент, желающий авторизоваться, знал, какие данные предоставить.

```
WWW-Authenticate: <type> realm=<realm>
Proxy-Authenticate: <type> realm=<realm>
```

`<type>` - схема аутентификации. *realm* используется для описания защищенной области или для индикации области защиты. Это может быть сообщение типа *Access to the staging site* или подобное, чтобы пользователь знал, к какой области он пытается получить доступ.

### Заголовки Авторизации и Прокси-Авторизации

Заголовки запросов [Authorization](https://developer.mozilla.org/ru/docs/Web/HTTP/Headers/Authorization) и [Proxy-Authorization](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Proxy-Authorization) содержат учетные данные для аутентификации агента пользователя (User Agent) на (прокси) сервере.

```
Authorization: <type> <credentials>
Proxy-Authorization: <type> <credentials>
```

### Схемы Аутентификации

Некоторые распространенные схемы аутентификации включают:

- **Basic**
- **Bearer**
- **Digest**
- **HOBA**
- **Mutual**
- **AWS4-HMAC-SHA256**

## Базовая схема аутентификации

*Базовая* схема HTTP-аутентификации передает учетные данные в виде пар пользователь ID/пароль, закодированных с использованием base64

### Безопасность базовой аутентификации

Поскольку идентификатор пользователя и пароль передаются по сети в виде открытого текста, схема базовой аутентификации не является безопасной. При базовой аутентификации следует использовать HTTPS/TLS.

### Ограничения доступа с помощью nginx и базовой аутентификации

Для nginx потребуется указать местоположение, которые нужно защитить и директиву *auth_basic*, которая задает имя защищенной паролем области. Директива *auth_basic_user_file* затем указывает на файл `.htpasswd`, содержащий зашифрованные учетные данные пользователя

```nginx
location /status {
	auth_basic			 "Access to the staging site";
	auth_basic_user_file /etc/apache2/.htpasswd;
}
```
